const input = `

...................................................................................................................................
..........#.............#...#........#....#.......#.#..#...........................##......#......#..#.###................#........
...#.#.......#.#......#.......#.........#.........#..#.#...........................................#........#...#.......#....#.#...
..#......#...#.........#...#......##......#.........#...........................#......##......##.....#...##.#....#...#............
......#...........#.............#......#.....#...#.#.#......................#..#...#.#......#..............#.......................
.#..........#.#.#.....................#......#...#.........................#.#...#...##......#.....#..#..........##................
.....#.#......#.........#.........##.....#..##.##..#.......................#.......###.#....#...#...#.......#.#..#.#..........##...
..#..#.....#....#..............................#...............#...................#...#.....#.#......#............................
..#..#........#....##..#.......#......#.#..##.................................#..#..................#................#....#........
.#..#........................#..#.....#.......##..............#............................#...........#.........#........###......
....#....#..#....#...#.........#.....#.#...#..#............#.......#...........##...##.#.#...#.....##..............................
....#..#.........#..#......#.....................##........#.........................#.............#.#....#.................#......
...#.......#......#............#......#...#....#...............#........#...............#...............##..#.#.......#..###..#....
......#..#.....#.....##...#..#.#..........................#..........................#........#.........................#......#...
.#.......##.........#.......#.#........................##..#...#...#.#.#................#..........#......#.......#...##..#..##.##.
..........#.............#.........#...##.................#.............#.#..............#.......##.....#..........#....#...........
.....#.#............#..#.............................#....##.............#...........#....#..........#.......................#.....
...................#................#................##......#.....#...##...#.............#.....#.......#.....................#....
.......#.#.#............#....##....#................#......#.#....#..#......#.#........................#.#...........#.....#.......
.....#.....#...###.......#.......#.#..#.................##.........##...........................##....#...##...........#...........
..#...#.........#...#..................#...........#.......#.#......#...#...................#..#.#..#......#..#.....#...........#..
.#...........#....#.....#.....#........#...........#..#..##...#...........#....##..............##........#...#...............#.#.#.
................#....#..#........#..#.#....................#................#.....#.............#..........#........#.....#..#.....
............................###...##...........#.#.....##....#....##..##...#..................##.........##............#..###......
.#..##........#.#......#...#.##....................#.........................#............................##....#..................
..#.........#..#.........#........................#.....##.............##.....#...............##........#....####..................
...#.#.##........................#.#...........#........##........................#............#.#.....#..........#....#...........
....#....#.....##...........#.....#..........#...#...#..............#...........#...............#...............#.....#....#.......
.#.........#....#.#................................#.....#.....#....#........#.........##.............#..#....#.......#.....#..#...
......##.....#.......#..........#.........#.#.........##....##.#...........##...#.#.......#......................#.................
..............#............#............#..............#.#.........###....#.#.......#.....#.......................#....#....#.#....
............##.....#.#.......#.........#.#..#..#.........#......#....#.....#....#.......................#.....#......#.............
..#.#....#....#.........##..#...................#..#..............#.......#.............................##...............#.........
.#....#...............#...#..........#..........#.........###..#.......#..##........#.#.....#..........#.....#.............#.......
.......#....#..........#.......................#..##.#.............#......................................#..............#...#.....
..#.##..........#............................#.............#..........#....#.......#...#..##.................................#.##..
......#...#..........#......................................#...........#..#.......#......#.#..............................#...#...
.#.#................##............#.......##......................#..#..#.....#.#..........#......................##...............
..#........#........#.............#..........#.....#..................#........#........#.................................#........
.###..##..#........................#.#......#........##.....#.....#......#..#........#.....#.................#...#.......#.........
.......#......#................#......#......##...............#................#....#..#...#....................###.....#.....#....
..#...........#...............................#...##....##...........#.#.#........................#................#......#......#.
....#..#.#...........................#....#.#..............#............#..#..##................#...............#..#..#.......##...
....##.#.......................#.....................#....#...................#.....#...#..............#.........#.#........#..#...
...##..........##........#.....#..........##...#..........................#.........#..#..#......#....................#.....##.....
..#......#...................#..#.##.........#.......#........................#.#.#.........................................#....#.
.#....####................#....#.#..#.#......#................#.....................#.#....#........#..##..........................
...........#.#...........##...............#..........#......................##....#.......#...##.....#....................#..#.....
.#..#................#...................#..#........#.....#.............................#.#...##.....................#........#...
........##..#................#..#....#........#......#..#.............#..........#...........#..............#.........#....#.......
..##....##.#.........#.#........#...........##..###..#.......#..................................#.#......#..#..#............#.##...
...........................#...#..#..##....#...#.......................#.....#...#.................................................
..#..#..#...................#..............................................#..#......#.......#................#.#..........#.......
........#.......##..........#.......#............#.##...............#......#...........#...............#..................###......
.#.#................#.....#..#.#...#...........................#.....#..#..........#...............#.#.............................
..............#.......................#........#.#.................................#.......#...#....#........#.#....#........#.....
..##....................#....#....#.........#..##..........#.......##..................................#..#..##..#...#.............
...#.............#......#....#...##........#......................#.............#......##............#..........##.................
..................##......#.........#....#..........#.#........................##.##.........................##....................
................#........#..#......................#.........#..............#....#...#...#..........................#..............
...................##...##..............#..#..#.#...##.....#.........##...........................#...##.#.........................
............#......#..........#......#..#.....##......#.................#..........#......#...#.........#........##.#..............
.....................#.#........................#...............#......#.#..#.........#....#................#..............#.......
..................#......#.#.....#......#............##.....#.#........#.#........#...#....#.....##..........#...#.................
........#...............................#.......#.........#....#...###......##..#....#.........#..##.........#.....#.......#.......
.................................................................S.................................................................
.....#.#......#.......##.#..#....#..#..#..............#...............#.............##.....#...#.###............#..................
.............#.........#.........#...........##.....#...........#..............#...#.................#.#..................#........
.......#.#...................#..........#..............##....##.............#..........#..#..#.........##..........................
...........#....#..............##........#............#...#....##........#.#....#.#.#...............#...#....#..........#..........
...........##.#.#.#......#........#..#....#...#........................#.............#......##...##..#.#...##........#.............
..#.......##....#...........#..................#....#....#..#.......###......................#.......................#.#...........
..............#......#.#..#...#.#.......................................#.###.................#............#...#...................
............#.........#.#.........##......................#..........#.......#....#.................#........#...#..##...........#.
...............#....#...#......#.....#......#.....#.....#....##...............#...............#....#............#..#...............
....##.........#.#....#.........#.....#.#...........#...............#.....###.........#..............#.....#.......................
..#.#....................#.......#..........#....#...#....#..#......#..#.##...#.#.#..#.#.......................##..............#...
....#..................#...#..#................#..#.#.................##..#..........#....#..............#...#.....................
..#....#...............................#.....#.......#..............##.#......#....#..........#..#....#.#.................#........
......##.......................#.......#.......................#...#......##...#.........#..#.......#...................#..........
...##.#..............#.....#..#.#...#......##.......#.........#.#..............#.....#...#..#...#.........#........................
....##.#......................##.#...#.........#........................#.#.................#......##........#...............#..#..
....#...##...........#.....#................#..#........#....#.............#.#.......................#....................#........
........##........................................#................#......................#................#.........##.#....#...#.
....#......#............#................#..................#........#...#.................#.............#.........#..#.#..........
.#.........#...................................#..............#.#....................#..................................#.#..##..#.
..##..#.##................#............#........#...........................#......###..#.....#..#...#............#.#.#....#.......
..........#........................#..#....###..##...#..............###..............#..#....#.#.##..................#.......#.....
.....#..#....#..............................................#...................#..................#.................#........#..#.
.....#...#.......#..#......................#.#...#.....#..#...#......#..#....#.#..............#.#.....#.......##.#...###......#.#..
...........................................#.#............#....#........#........#...........#.#..............................#....
......#........##..#.............#.#...##..#......................#......#.........#.#....#.................#......................
.#.#...#.#..#.#....##..............##...#......#.#....#....#....#.##...................#...##...#....................#...#.........
.#...#...........#................................#...###.............#.....#.........#....##...#..............#.............#...#.
............#.....................#..#.#..#............#....#...............#.#.......#..##................#............##.........
..#............##.......#.#...........#....#...#.....#.........#...........#..........#......#..........#......#...#....##.........
....#...................................................#.....#...#.................#.......#.#..............#.......#.#.#..##.....
..#.........##.#.#......#..#.........#.#...........##....#.........#...............#..#.......#....................#...............
.#..#...........##.#..........................#...............#.........#.................#............#...#.........#...#.......#.
...........#.................#.............................#............................#...........#.....##..........#...#....#...
....##..............##.....#..#...........#.........#..#.....#..#...............#..........#...............##....#......#........#.
.#...#.....#...........#..................#...#..###....#.........#..........#..#..#....#.#........##.#..##......#..........#......
.....#.#.#......##...#..........#..........#......#....#.................................#...........#...#.......#.............#...
....................#.......#.............#.......#.#....#......#...............#.....#.........#...##...#...............#.#.....#.
.#......#..................................#...........#.#.....#..#..#.....#....#.......................#..#....###..#.....##......
.......#.......#.......#.#..#...............#.#..#..#...#.#.....#.....#............#..#................................#...#.....#.
.#........##...........#.....#.....#...............................##..##...#......................#...........................##..
...............#........#.....#.##............#.#.................#....#.#..........#..........#....................#.........#....
.........................#..#....#..................#......##...............................#..#.....#.#.#................#.#....#.
......#.....................#..#..#..................................#..##....#................#...............#...#.#.............
....#.#.........#.............#.......#............#.....................................#.#.........#...#.......#....#.#..........
...#...##......#.#......#..#..#........###.................#.........#...#.#.............#.#...............#.............#.........
....#.......#.#.....#........#.........#...................#..#.....#....#...............#.........#...#.#.#.....#...........#.....
......#.#..........#..#..................#............................#..##...............##.....#..#..............................
............#.............................#.#...............#...#.....#..#.............#..........#.#...#......................#...
..#.###............................#.....#................#..##...##........#..........##........#........#.#......................
............###..........#..........#......#.............#...#.............#.......#..........#.#.....#......#..........#......#...
...#........#......#.............#.......#.....................#......##.................#.#........#.......................#.#....
.........#...#........#...#...##.#...#....#...#...................#.#.#............#.......#..#........#..#........#...............
.......................#..##.#.#.......#....#....#.....................................##...#........#.......................#.....
...#.##..#................#........................................##............#........#.......###.#.......#......#.#...........
......#....#......#..................#.....#......#.#.................................#.##..#.#.#.............#....#......#........
....##.....#.......##......#.#.....##.#........................#..............#........#..#....#................#.#.#..#....#......
......#.....#......#...#......##...#...........#....#..........................##.#..#..........#..#...............#....##..#...##.
...................#.#.......#.........#........#.................#.........#.......................#...#...#..#....#.#.....##.....
....#..#...#.#.#...#.#........................#........##.................#..........#.#.............#.....#....#..........##...#..
.....................##..........#....#....##...#..#...............................#........#...........#......#..##..#............
....#....##..#...#.......##..#....#..#........#.........................#...#....#.....#..........................#..##..#....#....
.................................#...#..#...#.#......#....#............#.......#......##.#.#.#....#............................#...
.......#.........#........#.###..................#..#.#.........................#.....#............#.............#......#..........
...................................................................................................................................
`

const tiles = input.trim().split("\n").map(row => row.trim().split(""));

const getStartPosition = (tiles) => {
    const rowCount = tiles.length;
    const colCount = tiles[0].length;
    let result = [];
    for (let i = 0; i < rowCount; i++) {
        for (let j = 0; j < colCount; j++) {
            if (tiles[i][j] === "S") {
                result = [i, j];
                break;
            }
        }
    }

    return result;
}


const pathFind = (tiles, startPosition, stepsCount) => {
    const rowCount = tiles.length;
    const colCount = tiles[0].length;
    const getKey = ([row, col]) => `${row},${col}`

    const isWall = ([row, col]) => tiles[row][col] === "#";

    const getAdjustedCoords = ([row, col]) => {
        const newRow = row % rowCount;
        const newCol = col % colCount;
        return [newRow >= 0 ? newRow : rowCount + newRow, newCol >= 0 ? newCol : colCount + newCol];
    }

    const cache = {};
    const getNeighbors = ([row, col]) => {
        const adjustedCoords = getAdjustedCoords([row, col]);

            if (isWall(adjustedCoords)) {
                return [];
            }

            return [
                [row - 1, col],
                [row, col + 1],
                [row + 1, col],
                [row, col - 1]
            ];
    };


    const queue = [[...startPosition, stepsCount]];
    while (queue.length) {
        const [row, col, step] = queue.shift();
        let neighbors = getNeighbors([row, col, step]);
        const key = getKey([row, col]);
        if ((cache[key]??-1) >= step)
            continue;

        neighbors.forEach(item => {
            cache[key] = step;
            if (step)
                queue.push([...item, step - 1]);
        });
    }
    return Object.values(cache).filter(step => step % 2 === 0).length;
}
const quadraticFunction = (a, b, c, x) => (a * Math.pow(x, 2)) + b * x + c;
const getPoly = (a, b, c) => {
    return [a / 2 - b + c / 2, -3 * (a / 2) + 2 * b - c / 2, a];
};

const steps = 26501365;
const ratio = steps % tiles.length
const mapCount = Math.floor(steps / tiles.length)
const start = getStartPosition(tiles);

const innerDiamond = pathFind(tiles, start, 65); // center to the edge of center tile
const midDiamond = pathFind(tiles, start, ratio+(ratio*2+1)); // to the center of outer tiles
const outerDiamond = pathFind(tiles, start, ratio+(ratio*4+2)); //  to the edge of outer tiles

console.log(quadraticFunction(...getPoly(innerDiamond, midDiamond, outerDiamond), mapCount))